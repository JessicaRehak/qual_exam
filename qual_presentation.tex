% NEUTRONICS BEAMER TEMPLATE -- START EDITING IN LINE 90
%\documentclass[xcolor=x11names, compress, handout]{beamer}
\documentclass[xcolor=x11names, compress]{beamer}
\usepackage{pgfpages}
\usefonttheme[onlymath]{serif}
\setbeamerfont{caption}{size=\scriptsize}
\setbeameroption{show notes on second screen=right}
\include{neutronics_template}
\setbeamertemplate{bibliography item}{\insertbiblabel}
% \setbeamertemplate{note page}{\pagecolor{yellow!5}\insertnote}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{appendixnumberbeamer}
\usepackage{booktabs}
\usepackage{amsmath}
\usepackage{tikz}
\usepackage{xcolor}
\usepackage[super]{nth}
\usepackage{sty/commands}
\usepackage{appendixnumberbeamer}
\newcommand\Warning{%
 \makebox[1.4em][c]{%
 \makebox[0pt][c]{\raisebox{.1em}{\small!}}%
 \makebox[0pt][c]{\color{red}\Large$\bigtriangleup$}}}%
%THIS IS THE BEAR WATERMARK IN THE COVER SLIDE; YOU MAY EXCLUDE IT
%\SetWatermarkText{\includegraphics{0calbear.jpg}}
%\SetWatermarkAngle{0}
%\SetWatermarkScale{0.61}
%%%%%%%%%%%%%%%%%%%%%%

\AtBeginSection[]{
  \begin{frame}[noframenumbering, plain]
  \vfill
  \centering
  \begin{beamercolorbox}[sep=8pt,center,shadow=true,rounded=true]{title}
    \usebeamerfont{title}\insertsectionhead\par%
  \end{beamercolorbox}
  \vfill
  \end{frame}
}

%THIS IS THE INFO AT THE BOTTOM OF YOUR FRAMES
\title{Qualification Exam}
\author{J.S. Rehak}
\date{September \nth{4}, 2019}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[plain]
%THIS IS THE TITLE OF THE TALK
\title{Title of Qualification Exam Talk}

%FEEL FREE TO EDIT THE COVER LAYOUT AS NEEDED
\author{
\begin{tabular}{c}
%YOUR NAME
J. S. Rehak\\
\vspace{10pt}\\
\includegraphics[height=2.5cm]{0bk.eps}
\end{tabular}}
\date{\vspace{-20pt}\\
  \begin{tabular}{c}
    \large{Qualification Exam} \\
 September \nth{4}, 2019
  \end{tabular}
}

\titlepage
\end{frame}

%----------------------------------------------------------%
% WHEN YOU START A NEW SECTION, IT WILL SHOW UP AS A CLICKABLE
% SHORTCUT AT THE TOP OF YOUR FRAMES

\begin{frame}
  \frametitle{Outline}
  \tableofcontents
\end{frame}

\section{Motivation}

\section{\scshape Background}

\frame[c]{\frametitle{Steady-state Boltzman Transport Equation}

  Our problem of interest is the time-independent transport equation
  for a critical system on a domain of interest
  $\rvec \in V$~\cite{lewis1993},
  
\begin{align*}
  &\left[ \oh\cdot  \nabla + \Sigma_t(\rvec,E) \right] \psi(\rvec,E,\oh)\\
  & \quad \quad \quad= \int_0^{\infty}dE'\int_{4\pi}d\oh'\Sigma_s(\rvec, E'\rightarrow E,\oh'\rightarrow\oh)
    \psi(\rvec,E',\oh') \\ & \quad \quad \quad+ Q(\rvec, E, \oh)\;,
\end{align*}
with a given boundary condition,
\begin{align*}
  \psi(\rvec,E,\oh) = \Gamma(\rvec, E, \oh), \quad \rvec \in \partial V,
  \quad \oh \cdot \hat{n} < 0
\end{align*}
}



\frame[c]{\frametitle{The multigroup $S_N$ equations}
  Apply the following discretizations:
  \begin{itemize}
  \item<1-> Apply a Petrov-Galerkin scheme in energy (multigroup
    method), splitting into $G$ coupled equations.
  \item<2-> Apply a collocation scheme in angle, solving at angles $\oh_a$.
  \item<3-> Expanding scattering cross-section in Legendre Polynomials
    with a maximum degree $N$ (the $P_N$ method).
  \end{itemize}

  \only<3>{
      \begin{equation*}
    \Sigma_{s,g'g,\ell} =
    \int_{-1}^{1}\Sigma_{s,g'g}(\rvec,\mu)P_{\ell}(\mu)d\mu, \quad \mu
    = \oh' \cdot \oh
  \end{equation*}
  \begin{equation*}
    \phi_{g, \ell, m} = \int_{4\pi}\phi_g(\rvec, \oh')Y_{\ell, m}(\oh')d\oh'
  \end{equation*}
}
\onslide<4->{
  \pause
  \begin{block}{Multigroup $S_N$ equations}\vspace{-0.25cm}
    \begin{align*}
      &\left[\oh_a \cdot \nabla + \Sigma_{t,g}(\rvec)\right]\psi_g(\rvec,
        \oh_a) \\
      & \quad \quad = \sum_{g' = 0}^{G}\sum_{\ell = 0}^N\sum_{m =-\ell}^{\ell}\Sigma_{s,g'g,\ell}
        Y_{\ell,m}(\oh_a)\phi_{g',\ell, m}(\rvec) + Q_g(\rvec, \oh_a)
    \end{align*}
  \end{block}
  }
  \note{
    \begin{itemize}      
    \item Multigroup method splits the equations into $G$ coupled equations
    \item Collocation scheme in angle uses points for a quadrature
      rule for integrating angular flux to get flux moments
    \item Expand in Legendre polynomials, use polynomial addition theorem,
    \end{itemize}
    }
  }

\frame[c]{\frametitle{Iterative Solving Methods}
  Expressed in operator form, this is
  \begin{align*}
    \mat{L}_g\mat{\Psi}_g = \mat{M}\sum^{G}_{g' = 0}\mat{S}_{g'  g}\mat{\Phi}_{g'}
    + \mat{Q}_g, \quad \mat{\Phi}_{g} = \mat{D}\mat{\Psi}_g\;.
  \end{align*}
  \pause
  Splitting the scattering source into down-scattering and up-scattering terms,
  \begin{align*}
    \mat{L}_g\mat{\Psi}_g = \mat{M}\sum^g_{g' = 0}\mat{S}_{g' 
    g}\mat{\Phi}_{g'}
    + \mat{M}\sum^G_{g' = g+1}\mat{S}_{g'  g}\mat{\Phi}_{g'}
    + \mat{Q}_g\;,
  \end{align*}
  \pause
  And holding the source $\mat{Q}$ fixed leads to a Gauss-Seidel (scattering) source iteration,
    \begin{align*}
    \mat{L}_g\mat{\Psi}^{k+1}_g = \mat{M}\sum^g_{g' = 0}\mat{S}_{g' 
    g}\mat{\Phi}^{k+1}_{g'}
    + \mat{M}\sum^G_{g' = g+1}\mat{S}_{g'  g}\mat{\Phi}^k_{g'}
    + \mat{Q}_g\;.
    \end{align*}
    \note{
      \begin{itemize}
      \item M is the moment-to-discrete, D is the reverse
      \item Important to note that the $G$-th energy group is the lowest.
      \end{itemize}
      }     
    }

\frame[c]{\frametitle{Iterative Solving Methods}
  For a multiplying-medium problem, the fixed source $\mat{Q}$ is
  replaced with the fission source,
  \begin{align*}
    \mat{L}_g\mat{\Psi}_g = \mat{M}\sum^{G}_{g' = 0}\left[\mat{S}_{g'  g}\mat{\Phi}_{g'}
    + \frac{1}{k}\mat{F}
    _{g'}\mat{\Phi}_{g'}\right]\;.
  \end{align*}
  Holding the scattering source fixed leads to power iteration
  (fission source iteration),
  \begin{align*}
    \mat{L}_g\mat{\Psi}^{k+1}_g = \mat{M}\sum^{G}_{g' = 0}\left[\mat{S}_{g'  g}\mat{\Phi}^{0}_{g'}
    + \frac{1}{k}\mat{F}_{g'}\mat{\Phi}^{k}_{g'}\right]\;.
  \end{align*}
}

\frame[c]{\frametitle{Fourier analysis}
  To see how the error in our iterative schemes evolves, we can use
  Fourier analysis~\cite{Adams2002}. To do so, we use a one-group, one
  dimension, infinite homogeneous medium with isotropic scattering.
  \begin{equation*}
    \mu\frac{\partial}{\partial x}\psi(x, \mu) + \Sigma_t\psi(x, \mu)
    = \frac{\Sigma_s}{2}\int_{-1}^{1}\psi(x, \mu')d\mu' +
    \frac{Q}{2}\;.
  \end{equation*}
  We define the source iteration scheme as discussed above,
  \begin{equation*}
    \mu\frac{\partial}{\partial x}\psi^{k+1}(x, \mu) + \Sigma_t\psi^{k+1}(x, \mu) = \frac{\Sigma_s}{2}\int_{-1}^{1}\psi^k(x, \mu')d\mu' + \frac{Q}{2}\;.
  \end{equation*}
   and subtract the two to get an equation for the error in iteration
   $k$, giving us a similar equation for the error in iteration $k+1$ as it
   relates to the error in iteration $k$,
   \begin{equation*}
         \mu\frac{\partial}{\partial x}e^{k+1}(x, \mu) + \Sigma_te^{k+1}(x, \mu) = \frac{\Sigma_s}{2}\int_{-1}^{1}e^k(x, \mu')d\mu'\;.
   \end{equation*}
  \note{
    \begin{itemize}
    \item How can we be sure that source iteration will converge? What
      controls the convergence rate? To determine this we can use a Fourier analysis.
    \item We need to start with a lot of assumptions to get a very
      simplified version of our transport equation.
    \item We define what we mean by error, and get an equation that
      relates the error in each step to the previous
      step. Unsurprisingly it looks like our original equation,
      because the evolution of the solution and the evolution of the
      error are related.
    \end{itemize}

    }
  }

\frame[c]{\frametitle{Fourier Analysis}
  To perform an inverse Fourier transform, we need to choose a
  measure of spatial variation, an error ``wavelength.''
  \pause
  \begin{equation*}
    \lambda = \frac{\ell}{n}, \quad \forall n \in \mathbb{R}
    \implies \lwn = \frac{1}{\lambda} = \frac{n}{\ell} = n \cdot \Sigma_t
  \end{equation*}
  \pause
    Perform an inverse Fourier transform,
    \begin{equation*}
      e^k(x, \mu) = \int_{-\infty}^{\infty}\hat{e}^k(n, \mu)e^{i\Sigma_t n x}dn\;.
    \end{equation*}
  \pause
  After plugging into our equation for error and some rearranging,
  \begin{equation*}
    \int_{-1}^{1}\hat{e}^{k+1}(n, \mu)d\mu = \Lambda(n)\int_{-1}^{1}\hat{e}^{k}(n, \mu')d\mu'\;,
  \end{equation*}
  Where
  \begin{equation*}
    \Lambda(n) = \frac{\Sigma_s}{\Sigma_t}\cdot \frac{\tan^{-1}{(n)}}{n}\;.
  \end{equation*}
       
    

    \note{
      \begin{itemize}
      \item We can examine the modes of the spatial error by using an
        inverse fourier transform. This will give us an idea of how
        the spatial frequencies of the error. We need to decide on an
        error wavelength, which gives us a linear error
        frequency. Higher $n$ means higher error frequency, with $n =
        0$ being infinite wavelength, completely non-coupled error.
      \item If we plug this back into our previous equation and do a
        large amount of manipulation, we get a fairly simple
        relationship between the integrated error in one step to the
        integrated error in the previous step.
      \item This lambda function is maximized when $n = 0$. The lowest
        frequency error converges the slowest, and at a rate
        proportional to $\Sigma_s/\Sigma_t$.
      \end{itemize}
      
      }
    }



\section{Acceleration Methods}

\frame[c]{\frametitle{Nonlinear Diffusion Acceleration (NDA)}
%\pause
  Start, with the single-group first-order transport
  equation~\cite{Hammer2017}, and integrate over angle:
  \begin{equation*}
    \nabla \cdot J_g + \left(\Sigma_{t,g} - \Sigma_s^{g\to g}\right)
    \phi_g = \sum_{g' \neq g}\Sigma_s^{g' \to g}\phi_{g'} + q_g,\quad J_g \equiv \int
    d\oh \oh \psi_g(\oh)\;.
  \end{equation*}
  %\pause
  As a closure to this problem, it is common to define current using \textit{Fick's law},
  \begin{equation*}
    J_g = -D\nabla \phi_g\;.
  \end{equation*}
  %\pause
  Construct an additive correction to the current using information
  from an angular solve:
  \begin{align*}
    J_g &= -D\nabla \phi_g + J_g^{\text{ang}} - J_g^{\text{ang}}\\
        &= -D\nabla \phi_g + \int_{4\pi}d\oh\oh\psi_g +
          D\nabla\phi_g
  \end{align*}
  
  \note{
    \begin{itemize}
    \item Uses a lower order diffusion solve to accelerate a higher
    order solve. 
  \item Start with the same single-group first-order
    transport equation, multiply by and integrate over angle, giving the
    ``neutron continuity equation.''
  \item We need closure for this problem, so often we use Fick's law,
    we will introduce a correction onto Fick's Law based on a higher
    order solve.
  \item We will introduce an additive correction based on our two
    definitions of the current.
    \end{itemize}
}
}

\frame[c]{\frametitle{Nonlinear Diffusion Acceleration (NDA)}
  Fold the additive correction into a \textit{drift-diffusion vector}:
  \begin{align*}
    J_g &= -D\nabla \phi_g + \int_{4\pi}d\oh\oh\psi_g +
          D\nabla\phi_g \\
        &= -D\nabla\phi_g + \left[\frac{\int_{4\pi}d\oh\oh\psi_g +
          D\nabla\phi_g}{\phi_g}\right]\phi_g \\
        &= -D \nabla \phi_g + \hat{D}_g\phi_g\;.
  \end{align*}
  %\pause
  Plugging this into our integrated transport equation gives the
low-order non-linear diffusion acceleration equation (LONDA),
  \begin{block}{}
    \begin{equation*}
      \nabla\cdot\left[-D\nabla + \hat{D}_g\right]\phi_g +
      \left(\Sigma_{t,g} - \Sigma_s^{g \to g}\right)\phi_g = \sum_{g' \neq g}\Sigma_s^{g' \to g}\phi_{g'} + q_g
    \end{equation*}
  \end{block}

  
  \note{
    \begin{itemize}
    \item We combine these corrections into a drift diffusion vector.
    \item This gives us the LONDA equation, which is just the same
      integrated transport equation with a corrected current term.
    \item Presumably, the ``higher order'' angular solve will have
      better current information, so we can use it to calculate the drift diffusion vector.
    \end{itemize}
  }
}

\frame[c]{\frametitle{NDA algorithm}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{images/nda_flowchart}
    \caption{NDA Algorithm.\label{fig:nda_algorithm}}
  \end{figure}

  \note{
    \begin{itemize}
    \item NDA algorithm showing inner low order loop, and outer high
      order loop.
    \item In general, outer loop updates both scattering and fission
      source, checking for $k$ convergence. Inner loop updates
      fission source, also checking $k$ convergence.
    \end{itemize}
  }
}

\frame[c]{\frametitle{Two-grid acceleration}

  
}

\section{BART}

\frame[c]{\frametitle{Transport equation second-order forms}
  Consider the mono-energetic form of the transport equation, using the scattering operator $S\psi(\rvec, \oh) = \int_{4\pi}d\oh'\Sigma_s(\rvec,
  \oh'\rightarrow\oh)\psi(\rvec,\oh')$:
  \begin{equation}
    \label{eq:monoenergetic}
    \left[\oh\cdot \nabla + \Sigma_t(\rvec)\right]\psi(\rvec, \oh) = 
    S\psi(\rvec, \oh) + Q
  \end{equation}
Substitute $-\oh$ for $\oh$, add to
Eq.~\eqref{eq:monoenergetic}, and divide by two to get a function of even-
and odd-parity angular fluxes.

\begin{align*}
  \oh\cdot\nabla\psi^- + \Sigma_t\psi^+ = S^+\psi^+ + Q^+
\end{align*}
where,
\begin{align*}
  \psi^+ = \frac{1}{2}\left(\psi(\oh) + \psi(-\oh)\right) \\
  \psi^- = \frac{1}{2}\left(\psi(\oh) - \psi(-\oh)\right) \\
\end{align*}

}

\frame[c]{\frametitle{Self-adjoint angular flux equation (SAAF)}
  
 Start with the single-group first-order transport equation~\cite{Morel1999}:
  \begin{equation}
    \label{eq:single_group_for_saaf}
    \oh \cdot \nabla \psi + \Sigma_t \psi = S \psi + q\;.
  \end{equation}
  %\pause
Solve for $\psi$,
  \begin{equation*}
    \psi = \frac{1}{\Sigma_t}\left[S\psi + q - \oh \cdot \nabla \psi\right]\;,
  \end{equation*}
  and plug back into the gradient term in
  Eq.\ref{eq:single_group_for_saaf}.
    %\pause
  \begin{block}{}
    \begin{equation*}
    - \oh \cdot \nabla \frac{1}{\Sigma_t}\oh \cdot \nabla \psi +
      \Sigma_t \psi = S\psi + q - \oh \cdot \nabla \frac{S\psi +
        q}{4\pi}
    \end{equation*}
  \end{block}
  With boundary conditions, for all $\vec{r} \in \partial D$:
  \begin{equation*}
      \psi = f, \quad \oh
      \cdot \hat{n} < 0 
    \end{equation*}
\begin{equation*}
      \oh \cdot \nabla \psi + \Sigma_t\psi= S\psi + q, \quad \oh
      \cdot \hat{n} > 0 
    \end{equation*}
\note{The Self-adjoint angular flux equation (SAAF) is a second-order from
  of the transport equation introduced by Morel and McGhee in 1999. To
  derive, consider scattering term part of tte source. Properties of SAAF
  \begin{itemize}
  \item +Can solve using standard CFEM methods, which give SPD matrices
    (can use CG instead of GMRES)  
  \item +Full angular flux is obtained by solve (unlike Even/Odd
    parity)
  \item +BCs only coupled in one direction when reflective
  \item -General sparse matrix, not block lower-triangular (no
    sweeping)
  \item -Pure scattering causes issues like odd-parity
  \end{itemize}

}
}

\frame[noframenumbering, plain]{\frametitle{References}
\tiny{\bibliographystyle{plain}}
\bibliography{bib/bib}
}

\appendix

\section{Backup Slides}

\frame[c]{\frametitle{Energy discretization}
  Introduce a discretization of the energy domain $\mathbb{E}$ into $G$
  non-overlapping elements, such that
  \begin{align*}
    E_h = \left\{E_1, E_2, \ldots, E_G\right\}, \quad \mathbb{E} = \bigcup_{g=1}^GE_g
  \end{align*}
  
  Assume that the energy-dependent angular flux can be separated into
  a group angular flux and a energy function within each of
  these groups
  \begin{align*}
    \psi(\rvec, E, \oh) \approx \psi_g(\rvec, \oh)f_g(E), \quad E \in E_g 
  \end{align*}

  This gives us $G$ coupled equations for each energy group,
  converting the integral scattering term into a summation,
  \begin{equation*}
    \left[\oh\cdot  \nabla +
      \Sigma_{t,g}(\rvec)\right]\psi_g(\rvec,\oh) = \sum_{g' = 0}^G\Sigma_{s,g'\to g}(\rvec, \oh' \to
  \oh)\psi_{g'}(\rvec,\oh') + Q_g(\rvec, \oh)\;.
  \end{equation*}

  \note{
    \begin{itemize}
    \item Say that the function $f_g$ is zero inside element, and 0
      outside, Petrov-Galerkin scheme.
    \end{itemize}
    
    }
}

\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
